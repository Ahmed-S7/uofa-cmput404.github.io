<!DOCTYPE html>
<html lang="en">
<head>
          <title>CMPUT 404 - Django Lab</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Web Applications and Architecture" />

  <link rel="icon" href="../theme/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../theme/style.css" />
  <link rel="stylesheet" type="text/css" href="../theme/404.css" />




    <meta name="tags" content="labs" />

</head>

<body>
        <header>
              <hgroup><h1><a href="../">CMPUT 404</a></h1><p>Web Applications and Architecture</p></hgroup>
        <nav><ul>
            <li><a href="/general/outline.html">Outline</a></li>
            <li><a href="/#eclass">eClass & Grades</a></li>
            <li><a href="/#schedule">Schedule</a></li>
            <li><a href="/general/labs.html">Labs</a></li>
            <li><a href="/general/project.html">Project</a></li>
            <li><a href="/general/individual.html">Participation</a></li>
            <li><a href="/general/resources.html">Resources</a></li>
            <li><a href="/general/help.html#discussion-forum">Discussion Forum</a></li>
            <li><a href="/#news-notices">News & Notices</a></li>
            <li><a href="/#lecture-zoom">Lecture Zoom</a></li>
            <li><a href="https://uofa-cmput404.github.io/slides-xt/">Slides</a></li>
            <li><a href="/general/help.html">Help</a></li>
        </ul></nav>
        </header>
        <main>
<article>
  <header>
    <h2>
      <a href="../labsignments/django.html" rel="bookmark"
         title="Permalink to Django Lab">Django Lab</a></h2>
 
  </header>
  <hr>
<style>
    html body main {
        background-image: url("/theme/draft.png");
        background-repeat: repeat;
        background-size: 100%;
    }
</style>

<h4 id="toc">[TOC]</h4>
<h3 id="description">Description</h3>
<p>The purpose of this lab is to familiarize you with setting up a virtual environment, developing with Django, and using npm to incorporate external packages like an emoji picker and a markdown editor. By the end of this lab, you will build a simple web app where users can add emojis and edit content using Markdown.</p>
<h3 id="getting-started">Getting Started</h3>
<h5 id="introduction-to-html-and-javascript">Introduction to HTML and JavaScript</h5>
<p>Before diving into Django and npm, letâ€™s go over some basics of HTML and JavaScript.</p>
<h5 id="html-basics">HTML Basics</h5>
<p>HTML is the structure of a webpage. It defines elements such as <strong>headings</strong> (<code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, etc.), <strong>paragraphs</strong> (<code>&lt;p&gt;</code>), and <strong>divs</strong> (<code>&lt;div&gt;</code>) to organize content.</p>
<h6 id="example-html-structure">Example HTML Structure:</h6>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My Web Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to My Web Page<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This is a paragraph inside a div.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ul>
<li><strong>Headings</strong> help organize content by importance. Use <code>&lt;h1&gt;</code> for the most important heading and <code>&lt;h6&gt;</code> for the least important.</li>
<li><strong>Divs</strong> are containers that group elements together. You can style or manipulate all content inside a div.</li>
</ul>
<h5 id="javascript-basics">JavaScript Basics</h5>
<p>JavaScript is used to add interactivity to a web page. You can manipulate the <strong>DOM</strong> (Document Object Model), which represents the structure of the page, to change content, styles, or even add new elements.</p>
<h6 id="example-javascript">Example JavaScript:</h6>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>JS Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;heading&quot;</span><span class="p">&gt;</span>Hello, World!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;changeTextBtn&quot;</span><span class="p">&gt;</span>Change Text<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;changeTextBtn&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;heading&#39;</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;You clicked the button!&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<hr>
<h4 id="prepare-your-repo">Prepare your Repo</h4>
<ol>
<li>Get the GitHub classroom link from eClass, create your assignment, and clone it.</li>
<li>Create an appropriate <code>.gitignore</code> file to prevent unwanted files from being committed to your repository. </li>
</ol>
<p>Place this <code>.gitignore</code> file in the root of your project. You can combine <a href="https://github.com/github/gitignore/blob/main/Python.gitignore">this one</a>, <a href="https://github.com/github/gitignore/blob/main/Node.gitignore">this one</a>, and <a href="https://github.com/django/django/blob/main/.gitignore">this one</a> for your Django + Node project. Use <code>git status</code> to ensure you're not staging any unwanted files before committing.</p>
<h4 id="create-the-virtual-environment">Create the Virtual Environment</h4>
<p>A virtual environment is a tool for managing Python dependencies specific to your project. Each project may have different requirements, and a virtual environment helps you manage these dependencies independently.</p>
<h5 id="setting-up-python">Setting up Python:</h5>
<p>If you have multiple versions of Python installed, always specify the version number:</p>
<div class="highlight"><pre><span></span><code>python3.11<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
</code></pre></div>

<h5 id="check-for-pip-and-venvvirtualenv">Check for pip and venv/virtualenv:</h5>
<p>To verify if you have pip:</p>
<div class="highlight"><pre><span></span><code>python3.11<span class="w"> </span>-m<span class="w"> </span>pip
</code></pre></div>

<p>To check if <code>venv</code> or <code>virtualenv</code> is installed:</p>
<div class="highlight"><pre><span></span><code>python3.11<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--help
</code></pre></div>

<p>If you don't have <code>venv</code>, install it using pip:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>virtualenv
</code></pre></div>

<h5 id="activate-virtual-environment">Activate Virtual Environment:</h5>
<p>To activate the virtual environment:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>venv/bin/activate
</code></pre></div>

<hr>
<h4 id="installing-nodejs-and-npm">Installing Node.js and npm</h4>
<p>To install Node.js, download the LTS version from the <a href="https://nodejs.org/en/download">Node.js website</a>. The installation will include npm as well, which we will use to manage JavaScript packages.</p>
<hr>
<h3 id="lab-instructions">Lab Instructions</h3>
<h4 id="django-setup">Django Setup</h4>
<p>We will use <a href="https://www.djangoproject.com/">Django</a>, a high-level Python web framework. It simplifies web development by providing a built-in ORM, an admin panel, and much more. The <a href="https://docs.djangoproject.com/en/5.0/">official documentation</a> is a valuable resource.</p>
<h5 id="steps-to-set-up-django">Steps to Set Up Django:</h5>
<ol>
<li>Create a virtual environment and install Django:</li>
</ol>
<p><code>virtualenv venv --python=python3
   source venv/bin/activate
   echo "Django&gt;=5.0.1" &gt; requirements.txt
   python -m pip install -r requirements.txt</code></p>
<ol>
<li>Start a new Django project:</li>
</ol>
<p><code>django-admin startproject lab2
   cd lab2
   python manage.py runserver 0.0.0.0:8000</code></p>
<p>You should see a "Congratulations!" page when visiting <code>localhost:8000</code>.</p>
<h5 id="creating-a-django-webapp">Creating a Django Webapp</h5>
<p>We will create a Django webapp called <code>emojis</code> to build a simple emoji picker app.</p>
<ol>
<li>
<p>Create a new app:
   <code>python manage.py startapp emojis</code></p>
</li>
<li>
<p>In <code>emojis/views.py</code>, add the following code:</p>
</li>
</ol>
<p>```
   from django.http import HttpResponse</p>
<p>def index(request):
       return HttpResponse("This is the emoji app.")</p>
<p>```</p>
<ol>
<li>Create a <code>urls.py</code> file inside <code>emojis</code> and add the following code:
   ```
   from django.urls import path
   from . import views</li>
</ol>
<p>urlpatterns = [
       path("", views.index, name="index"),
   ]
   ```</p>
<ol>
<li>Update <code>lab2/urls.py</code> to include the new app:
   <code>from django.urls import include, path
   urlpatterns = [
       path("emojis/", include("emojis.urls")),
       path("admin/", admin.site.urls),
   ]</code></li>
</ol>
<hr>
<h4 id="adding-html-templates">Adding HTML Templates</h4>
<p>Django allows you to render HTML templates. Letâ€™s create an HTML page to display the emoji picker.</p>
<ol>
<li>Inside the <code>emojis</code> directory, create a <code>templates</code> directory.</li>
<li>Inside <code>templates</code>, create an <code>index.html</code> file with the following boilerplate:
   ```html
   <!DOCTYPE html></li>
</ol>
<html lang="en">
       <head>
           <meta charset="UTF-8">
           <title>Emojis App</title>
       </head>
       <body>
           <h1>Welcome to Emojis!</h1>
       </body>
   </html>

<ol>
<li>Update <code>emojis/views.py</code> to render the template:
   ``` 
   from django.shortcuts import render</li>
</ol>
<p>def index(request):
       return render(request, "index.html")
   ```</p>
<p>Now, visiting <code>localhost:8000/emojis</code> will display the HTML template.</p>
<hr>
<h4 id="adding-markdown-editor">Adding Markdown Editor</h4>
<p>In this section, we will integrate a <strong>Markdown editor</strong> so that users can write content in Markdown format and see it rendered as HTML in the browser. We'll use the popular npm package <code>marked</code> for parsing Markdown content and converting it to HTML.</p>
<h5 id="steps-to-add-the-markdown-editor">Steps to Add the Markdown Editor:</h5>
<ol>
<li>
<p>Install the <code>marked</code> package using npm:
   <code>bash
   npm install --save-dev marked</code></p>
</li>
<li>
<p>Update your <code>main.js</code> file to incorporate both the Markdown editor and the emoji picker:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Picker</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;emoji-mart&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Import the emoji picker</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">marked</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;marked&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Import the markdown converter</span>

<span class="c1">// Set up emoji picker</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">pickerOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">onEmojiSelect</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">emoji</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">textarea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;markdown-editor&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">textarea</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">emoji</span><span class="p">.</span><span class="kr">native</span><span class="p">;</span><span class="w"> </span><span class="c1">// Add selected emoji to the editor</span>
<span class="p">}};</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">picker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Picker</span><span class="p">(</span><span class="nx">pickerOptions</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;emoji-picker&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">picker</span><span class="p">);</span><span class="w"> </span><span class="c1">// Add emoji picker to the DOM</span>

<span class="c1">// Handle Markdown conversion and rendering</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;convert-btn&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">markdownText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;markdown-editor&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">htmlOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">marked</span><span class="p">(</span><span class="nx">markdownText</span><span class="p">);</span><span class="w"> </span><span class="c1">// Convert markdown to HTML</span>
<span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;markdown-output&#39;</span><span class="p">).</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">htmlOutput</span><span class="p">;</span><span class="w"> </span><span class="c1">// Display HTML content</span>
<span class="p">});</span>
</code></pre></div>

<ol>
<li>Modify your <code>index.html</code> file to include both the Markdown editor and the emoji picker:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Markdown and Emoji App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to the Markdown and Emoji App!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;emoji-picker&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> <span class="cm">&lt;!-- Emoji Picker --&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Markdown Editor<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;markdown-editor&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;50&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Write in Markdown...&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;convert-btn&quot;</span><span class="p">&gt;</span>Convert to HTML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Output<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;markdown-output&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> <span class="cm">&lt;!-- Rendered HTML output --&gt;</span>



    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{% static &#39;main.min.js&#39; %}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> <span class="cm">&lt;!-- Load bundled JS --&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<ol>
<li>Bundle the <code>main.js</code> file again using esbuild:</li>
</ol>
<div class="highlight"><pre><span></span><code>npx<span class="w"> </span>esbuild<span class="w"> </span>main.js<span class="w"> </span>--bundle<span class="w"> </span>--minify<span class="w"> </span>--sourcemap<span class="w"> </span>--outfile<span class="o">=</span>./emojis/static/main.min.js
</code></pre></div>

<hr>
<h4 id="integrating-with-django-models-orm">Integrating with Django Models (ORM)</h4>
<p>Now that we have a Markdown editor and emoji picker set up, letâ€™s store the content users create in a Django model.</p>
<ol>
<li>Update <code>emojis/models.py</code> to create a model for storing user-created pages:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>  <span class="c1"># Markdown content</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</code></pre></div>

<ol>
<li>In <code>emojis/views.py</code>, create a new view to handle saving the Markdown content to the database:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Page</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Untitled&#39;</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">})</span>
</code></pre></div>

<ol>
<li>In <code>emojis/urls.py</code>, add the new route for saving content:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;save/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">save_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;save_page&quot;</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<ol>
<li>Modify the HTML form in <code>index.html</code> to send data to the server and save the page:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-form&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;page-title&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Page Title&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;markdown-editor&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;content&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;50&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;save-btn&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Save Page<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>

<ol>
<li>In <code>main.js</code>, handle the form submission using JavaScript and send the content via a POST request:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;save-btn&#39;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;page-title&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;markdown-editor&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>

<span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/save/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;X-CSRFToken&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1">//  CSRF token</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="nx">title</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="nx">content</span><span class="p">})</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// Handle the response from the server</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<hr>
<h4 id="serving-static-files-with-whitenoise">Serving Static Files with Whitenoise</h4>
<p>Now that we have a Django app with Markdown editing, emoji picking, and content storage, we need to serve static files efficiently. We'll use <strong>Whitenoise</strong> for this.</p>
<ol>
<li>
<p>Install Whitenoise:
   <code>pip install whitenoise</code></p>
</li>
<li>
<p>Update <code>settings.py</code> to use Whitenoise:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>MIDDLEWARE = [
    &#39;whitenoise.middleware.WhiteNoiseMiddleware&#39;,  # line for middleware
    # other middleware...
]

STATICFILES_STORAGE = &#39;whitenoise.storage.CompressedManifestStaticFilesStorage&#39;

STATIC_URL = &#39;/static/&#39;
STATIC_ROOT = BASE_DIR / &#39;staticfiles&#39;
</code></pre></div>

<ol>
<li>
<p>Run <code>collectstatic</code> to gather all static files:
   <code>python manage.py collectstatic</code></p>
</li>
<li>
<p>Restart the Django server, and now Whitenoise will handle serving static files, including the JavaScript bundle.</p>
</li>
</ol>
<hr>
<h4 id="conclusion-and-submission">Conclusion and Submission</h4>
<p>At the end of this lab, you will have built a fully functioning web app with the following features:
- An emoji picker using the <code>emoji-mart</code> npm package.
- A Markdown editor where users can write content and convert it to HTML.
- Content storage in a Django model using the ORM.
- Efficient serving of static files with Whitenoise.</p>
<h5 id="submission-instructions">Submission Instructions</h5>
<ol>
<li>Push your code to GitHub Classroom <strong>before the deadline</strong>.</li>
<li>Ensure your repository contains only the necessary files, and your <code>.gitignore</code> excludes built files (<code>venv/</code>, <code>node_modules/</code>, <code>main.min.js</code>).</li>
</ol>
<p>Submit your repository link on eClass.</p>
<hr>
<h5 id="further-tips">Further Tips</h5>
<ul>
<li>If you encounter issues with static files, ensure your file paths are correct and that Djangoâ€™s <code>STATIC_URL</code> is configured properly.</li>
<li>For more detailed error handling or improving the user interface, consider adding feedback when content is saved or emoji selection is confirmed.</li>
</ul>
  <footer>
    <p>Published: <time datetime="2024-09-05T00:00:00-06:00">
      Thu, 05 Sep 2024 at 00:00 MDT
    </time></p>
    <address>
      By           <a href="../author/alireza-azimi.html">Alireza Azimi</a>
          <a href="../author/mo-adel-abdelghany.html">Mo Adel Abdelghany</a>
    </address>
    <p>
        Category: <a href="../category/labsignments.html">labsignments</a>
    </p>
    <p>
        Tags:
            <a href="../tag/labs.html">labs</a>
    </p>
  </footer>
  </article>
        </main>
        <footer>
                <address>
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>,
                which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address>
        </footer>
</body>
</html>